@{
    ViewBag.Title = "Home Page";
}
<style type="text/css">
    .contain_box
    {
        width: 300px;
        border: 1px solid #ccc;
        padding: 4px 4px;
    }
    
    #discussion
    {
        margin-left: 0px;
    }
    
    .question_input
    {
    }
    .question_item
    {
        /*border: 1px solid #3399FF;*/
        list-style: none;
        margin-bottom: 5px;
    }
    
    .question_item .content
    {
        color: #3399FF;
        border: 1px solid #ccc;
        padding: 5px;
    }
    
    .question_item input
    {
        width: 100px;
    }
    
    .answer_item
    {
        color: #000;
    }
</style>
<h2>@ViewBag.Message</h2>
<div class="contain_box">
    <p>
        Ask a question:</p>
    <input type="text" id="message" />
    <input type="button" id="sendmessage" value="Send" />
    <input type="hidden" id="displayname" value="@User.Identity.Name" />
    <ul id="discussion">
        @*<li class="question_item">
            <div class="content">
                question
            </div>
            <ul class="answers">
                <li class="answer_item">
                    <input  type="text" />
                    <input type="button" id="sendanswer" value="Answer" />
                </li>
            </ul>
        </li>*@
    </ul>
</div>
<!--Script references. -->
<!--Reference the SignalR library. -->
<script type="text/javascript" src="/Scripts/jquery.signalR-1.0.1.js"></script>
<!--Reference the autogenerated SignalR hub script. -->
<script type="text/javascript"  src="@Url.Content("~/signalr/hubs")"></script>
<!--Add script to update the page and send messages.-->
<script type="text/javascript">
    $(function () {

        $('.showall').live('click', function () {
            // $('#answers_' + qid + ' li').hide();

            var qid = $(this).attr("data-value");
            $('#answers_' + qid + ' li').show();
        });

        // Declare a proxy to reference the hub. 
        var chat = $.connection.chatHub;
        // Create a function that the hub can call to broadcast messages.
        chat.client.broadcastMessage1 = function (name, message, type, qid) {

            if (type != 'Q') {
                var count = $('#answers_' + qid + ' li').size();
                if (count > 3)
                    var myvar = count - 4;
                //$('#answers_' + qid + ' li').hide();
                $('#answers_' + qid + ' li').filter(':lt(' + myvar + ')').hide();
                $('#answers_' + qid).append('<li>' + message + $('#answers_' + qid + ' li').size() + '</li>');

            } else {
                // Html encode display name and message. 
                var encodedName = $('<div />').text(name).html();
                var encodedMsg = $('<div />').text(message).html();
                // Add the message to the page. 
                $('#discussion').prepend('<li id="' + qid + '" class="question_item">'
                + '<div class="content">'
                    + message
                + '</div>'
                + '<p><a class="showall" data-value="' + qid + '" href="javascript:">show all</a></p>'
                + '<ul id="answers_' + qid + '">'

                + '</ul>'
                + '<div class="asw_input">'
                        + '<input type="text" />'
                        + '<input type="hidden" value="' + qid + '" />'
                        + '<input type="button" class="sendanswer" value="Answer" name="' + qid + '" />'
                + '</div>'
            + '</li>'

            );
            }
        };
        // Get the user name and store it to prepend to messages.
        //$('#displayname').val(prompt('Enter your name:', ''));
        // Set initial focus to message input box.  
        $('#message').focus();
        // Start the connection.
        $.connection.hub.start().done(function () {
            $('#sendmessage').click(function () {
                // Call the Send method on the hub. 
                chat.server.send($('#displayname').val(), $('#message').val(), "Q", "");
                // Clear text box and reset focus for next comment. 
                $('#message').val('').focus();
            });

            $(".sendanswer").live('click', function () {
                var answer_text = $(this).siblings('input:text').val();
                var qid = $(this).siblings('input:hidden').val();
                chat.server.send($('#displayname').val(), answer_text, "A", qid);
            });


        });
    });
</script>
